name: Build Docs

on:
    push:
        branches:
            - main
    pull_request:
        branches:
            - main

jobs:
    build-docs:
        runs-on: ubuntu-latest
        steps:
          - name: Checkout repository
            uses: actions/checkout@v2
          - name: Set up Node.js
            uses: actions/setup-node@v2
          - name: Install Doxygen
            run: sudo apt-get install doxygen -y
          - name: Switch to docs directory
            run: cd docs/doxygen
          - name: Install npm dependencies
            run: npm install
          - name: Build documentation
            run: make html
          - name: Deploy documentation
            uses: peaceiris/actions-gh-pages@v3
            with:
                github_token: ${{ secrets.GITHUB_TOKEN }}
                publish_dir: docs/doxygen/build/html
                publish_branch: gh-pages
                cname: docs.riot.annsann.eu
                commit_message: "Deploy documentation"
